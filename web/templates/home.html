<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="author" content="BotoX">
<meta name="description" content="Ninebot ES/SNSC Custom Firmware Toolkit">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/png" href="static/favicon.png">
<link rel="stylesheet" type="text/css" href="static/style.css">
<title>Ninebot ES/SNSC Custom Firmware Toolkit</title>
</head>

<body>

<div class="header">
	<p><a href="https://www.scooterhacking.org">Return to ScooterHacking.org</a> - <a href="https://sctrhck.ml/discord">Join our Discord server</a> - <a href="https://ninebot.scooterhacking.org/fr">Version fran√ßaise</a>
    <h1>Ninebot ES/SNSC Custom Firmware Toolkit</h1>
</div>

<div class="content">
<p>
    Configure your own custom firmware by adjusting the options below.<br>
    There are safety checks in place to ensure your scooter will not be bricked.<br>
    Be aware that a higher motor power will shorten the lifetime of your battery and could damage your motor.<br>
    By default nothing will be patched, enable patches with the "Patch?" checkbox next to them.<br />
	Please remember that ScooterHacking.org or its members can not be held responsible for any damage you may cause to yourself or your scooter.<br />
    The software is provided "as is", without warranty of any kind, express or implied, including but not limited to the warranties of merchantability, fitness for a particular purpose and noninfringement.<br />
    In no event shall the authors or copyright holders be liable for any claim, damages or other liability, wether in an action of contract, tort or otherwise, arising from, out of or in connection with the software or the use or other other dealings in the software.
</p>

<p>
    Presets:
    <button onclick="Preset_Default();">Default</button>
</p>

<noscript>This website (despite it's look) requires some very simple JavaScript which is embedded in this HTML.</noscript>

<hr>
<form action="http://py.scooterhacking.org:5000/cfw" onsubmit="return confirm('Do you really want to generate your CFW? You\'re running the risk of bricking your scooter, this is HIGHLY experimental!');">
<ul>
    <li><p>
        Base version of your firmware:
        <select name="version">
            <option value="DRV120">1.2.0</option>
            <option value="DRV133" selected>1.3.3</option>
			<option value="DRV139">1.3.9 (experimental)</option>
			<option value="DRV147">1.4.7 (very experimental)</option>
        </select>
        <br>
        1.3+ is recommended over 1.2.0, because you likely won't need to downgrade the BMS.
    </p></li>

    <li><p>
        KERS minimum speed:
        <input name="kers_min_speed" type="number" step="1" min="0" max="100" value="6" disabled>
        <label><input type="checkbox" onchange="CheckForm('kers_min_speed', this);">Patch?</label>
        <br>
        Speed in km/h at which the scooter will start braking on it's own when the motor is not active.<br />
		You will still have recuperative braking when using the brake lever.<br />
		If you want "KERS OFF" then just put this to 40km/h.
    </p></li>
	
    <li><p>
        KERS dividor:
        <input name="kers_dividor" type="number" step="4" min="2" max="6" value="2" disabled>
        <label><input type="checkbox" onchange="CheckForm('kers_dividor', this);">Patch?</label>
        <br>
        At which factor the KERS strength is divided.<br /><i>Only 6 and 2 are available to prevent bricks.</i><br />
    </p></li>

    <li><p>
        Maximum speed:
        <input name="max_speed" type="number" step="1" min="0" max="45" value="32" disabled>
        <label><input type="checkbox" onchange="CheckForm('max_speed', this);">Patch?</label>
        <br>
        The scooter will stay below this speed. Use it if you're running at limited speed even in Sport mode. 
    </p></li>

    <li><p>
        Cruise control delay:
        <input name="cruise_control_delay" type="number" step="1" min="1" max="100" value="5" disabled>
        <label><input type="checkbox" onchange="CheckForm('cruise_control_delay', this);">Patch?</label>
        <br>
        How many seconds it takes for cruise control to kick in.
    </p></li>	

    <li><p>
        Motor start speed:
        <input name="motor_start_speed" type="number" step="1" min="0" max="10" value="5" disabled>
        <label><input type="checkbox" onchange="CheckForm('motor_start_speed', this);">Patch?</label>
        <br>
        Minimum speed in km/h before the motor will start. <b><font color="orange">New!</font></b>
    </p></li>
	
    <li><p>
        Version spoofing:
        <label><input type="checkbox" name="version_spoofing"></label>
        <br>
        Makes the version number higher to prevent updates from the Ninebot app. <font color="red">Soon!</font>
    </p></li>
	
    <li><p>
        Alternative throttle algorithm:
        <label><input type="checkbox" name="throttle_alg"></label>
        <br>
        Uses the alternative throttle algorithm. 
    </p></li>
	
    <li><p>
        Motor power constant:
        <input name="motor_power_constant" type="number" step="1" min="20000" max="65535" value="51575" disabled>
        <label><input type="checkbox" onchange="CheckForm('motor_power_constant', this);">Patch?</label>
        <br>
        Lower = More power. Too much power is not recommended for battery and motor life.<br>
        <b>Modifying this value without knowing what you're doing will surely break your scooter.</b>
    </p></li>


</ul>
<hr>

<p>
    Make sure to double check all of your entered values before submitting!<br>
    <b>I AM RESPONSIBLE FOR THE ENTERED VALUES:</b>
    <input type="submit" value="Patch!"/>
    <button type="button" onclick="Share();">Share</button>
    <span id="shareConfirmation"></span>
</p>
</form>

<p>
    <b><span style="color: red;">&#9888;&nbsp;NEW </span>The tool now makes .zip files with both encrypted and unencrypted firmware and an info.txt inside.</b><br>
    <b><span style="color: red;">&#9888;&nbsp;NEW </span>Use the following Windows app made by majsi to flash your modified firmware: <a href="https://www.microsoft.com/en-us/p/ninebot-flasher/9p5hws0hq55s?activetab=pivot:overviewtab">Ninebot-Flasher</a></b><br>
	<b><span style="color: red;">&#9888;&nbsp;NEW </span>Use the following Android app made by CamiAlfa to flash your modified firmware: <a href="https://play.google.com/store/apps/details?id=com.esdowngrade">ES DownG</a></b><br>
	</p>

<hr>
<p>
    Source code on GitHub: <a href="https://github.com/scooterhacking/ninebot-es-snsc-firmware-patcher" target="_blank">https://github.com/scooterhacking/ninebot-es-snsc-firmware-patcher</a>
    <br>
    <b>Donate to majsi (CFW scripting): <a href="https://www.paypal.me/majsinko" target="_blank">https://www.paypal.me/majsinko</a><br />
	Donate to CamiAlfa (ES DownG): <a href="https://www.paypal.me/camialfa" target="_blank">https://www.paypal.me/camialfa</a><br />
	Donate to ScooterHacking.org (host and maintainer): <a href="https://paypal.me/scooterhacking" target="_blank">https://paypal.me/scooterhacking</a><br />
	Donate to Botox (original creator of the M365 CFW toolkit): <a href="https://paypal.me/BotoXbz" target="_blank">https://paypal.me/BotoXbz</a></b>
</p>
</div>

<script>
    var forms = {
        "VERSION": "version",
        "KERS_MIN_SPEED": "kers_min_speed",
        "KERS_DIVIDOR": "kers_dividor",
        "MAX_SPEED": "max_speed",
        "VERSION_SPOOFING": "version_spoofing",
        "MOTOR_POWER_CONSTANT": "motor_power_constant",
		"CRUISE_CONTROL_DELAY": "cruise_control_delay",
		"THROTTLE_ALG": "throttle_alg",
		"MOTOR_START_SPEED": "motor_start_speed"
    };

    var formValues = Object.values(forms);
    var queryStrings = window.location.search.substring(1);
    var queries = queryStrings.split('&');

    for (var i = 0; i < queries.length; i++) {
        var query = queries[i];
        var tmp = query.split('=');
        var found = false;

        for (var j = 0; j < formValues.length; j++) {
            if (formValues[j] === tmp[0]) {
                found = true;
                break;
            }
        }

        if(found) {
            if (tmp[1] === 'on') {
                tmp[1] = true;
            }

            ChangeForm(tmp[0], tmp[1], true);
        }
    }

    function GetForm(name) {
        return document.getElementsByName(name)[0];
    }

    function GetFormValue(name) {
        var o = GetForm(name);

        if (o.type === "checkbox") {
            return o.checked;
        }

        return o.value;
    }

    function GetPatchCheckBox(name) {
        var form = GetForm(name);
        return form.nextElementSibling && form.nextElementSibling.children[0];
    }

    function CheckForm(name, cb) {
        GetForm(name).disabled = !cb.checked;
    }

    function ChangeForm(name, value, patch) {
        var o = GetForm(name);

        if (o.type === "checkbox") {
            o.checked = value;
        } else {
            o.value = value;
        }

        if (typeof patch === 'boolean') {
            var cb = GetPatchCheckBox(name);

            if (cb) {
                cb.checked = patch;
                cb.onchange();
            }
        }
    }

    function Preset_Default() {
        ChangeForm(forms.VERSION, "DRV133");
        ChangeForm(forms.KERS_MIN_SPEED, "6", false);
        ChangeForm(forms.MAX_SPEED, "32", false);
        ChangeForm(forms.KERS_DIVIDOR, "6", false);
        ChangeForm(forms.MOTOR_POWER_CONSTANT, "51575", false);
		ChangeForm(forms.CRUISE_CONTROL_DELAY, "5", false);
        ChangeForm(forms.VERSION_SPOOFING, false);
		ChangeForm(forms.THROTTLE_ALG, false);
		ChangeForm(forms.MOTOR_START_SPEED, "5", false);
    }


    function Share() {
        var url = location.protocol + '//' + location.host;
        var firstParam = true;

        function getSeparator() {
            if (firstParam) {
                firstParam = false;
                return '?';
            }

            return '&';
        }

        for (var i = 0; i < formValues.length; i++) {
            var form = formValues[i];

            var formValue = GetFormValue(form);
            var patchCheckbox = GetPatchCheckBox(form);

            if (patchCheckbox) {
                if (patchCheckbox.checked) {
                    url += getSeparator() + form + '=' + formValue;
                }
            } else if (typeof formValue === 'boolean') {
                if (formValue) {
                    url += getSeparator() + form + '=on';
                }
            } else {
                url += getSeparator() + form + '=' + formValue;
            }
        }

        var textArea = document.createElement("textarea");

        textArea.value = url;
        document.body.appendChild(textArea);

        textArea.focus();
        textArea.select();

        document.execCommand('copy');
        document.getElementById('shareConfirmation').innerText = 'Copied!';

        document.body.removeChild(textArea);
    }
</script>
</body>
